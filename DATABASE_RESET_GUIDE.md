# üîÑ Database Reset Guide for Railway

–¶–µ–π –≥–∞–π–¥ –æ–ø–∏—Å—É—î —è–∫ –±–µ–∑–ø–µ—á–Ω–æ —Å–∫–∏–Ω—É—Ç–∏ –±–∞–∑—É –¥–∞–Ω–∏—Ö –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—ñ (Railway) –∑ –Ω–æ–≤–æ—é —Å—Ö–µ–º–æ—é.

## ‚ö†Ô∏è –í–ê–ñ–õ–ò–í–û

**–¶–µ–π —Å–∫—Ä–∏–ø—Ç –≤–∏–¥–∞–ª–∏—Ç—å –í–°–Ü –¥–∞–Ω—ñ –∑ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö!** –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –π–æ–≥–æ —Ç—ñ–ª—å–∫–∏ —è–∫—â–æ –≤–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –ø–æ–≤–Ω—ñ—Å—Ç—é –æ—á–∏—Å—Ç–∏—Ç–∏ –±–∞–∑—É –¥–∞–Ω–∏—Ö —Ç–∞ —Å—Ç–≤–æ—Ä–∏—Ç–∏ —Ç–∞–±–ª–∏—Ü—ñ –∑–∞–Ω–æ–≤–æ.

## üìã –©–æ —Ä–æ–±–∏—Ç—å —Å–∫—Ä–∏–ø—Ç

–°–∫—Ä–∏–ø—Ç [`backend/reset_database.py`](backend/reset_database.py) –≤–∏–∫–æ–Ω—É—î –Ω–∞—Å—Ç—É–ø–Ω—ñ –¥—ñ—ó:

1. ‚úÖ –ó–∞–ø–∏—Ç—É—î –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è –ø–µ—Ä–µ–¥ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è–º
2. üóëÔ∏è –í–∏–¥–∞–ª—è—î –≤—Å—ñ —ñ—Å–Ω—É—é—á—ñ —Ç–∞–±–ª–∏—Ü—ñ (DROP TABLE IF EXISTS)
3. üèóÔ∏è –°—Ç–≤–æ—Ä—é—î —Ç–∞–±–ª–∏—Ü—ñ –∑–∞–Ω–æ–≤–æ –∑ –∞–∫—Ç—É–∞–ª—å–Ω–æ—é —Å—Ö–µ–º–æ—é –∑ [`database.py`](backend/database.py)
4. üë§ –°—Ç–≤–æ—Ä—é—î –¥–µ—Ñ–æ–ª—Ç–Ω–∏–π –ø—Ä–æ—Ñ—ñ–ª—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
5. üîç –ü–µ—Ä–µ–≤—ñ—Ä—è—î —â–æ –≤—Å—ñ —Ç–∞–±–ª–∏—Ü—ñ —Å—Ç–≤–æ—Ä–µ–Ω—ñ –ø—Ä–∞–≤–∏–ª—å–Ω–æ

## üöÄ –Ø–∫ –∑–∞–ø—É—Å—Ç–∏—Ç–∏ –Ω–∞ Railway

### –ú–µ—Ç–æ–¥ 1: –ß–µ—Ä–µ–∑ Railway CLI (–†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ)

1. **–í—Å—Ç–∞–Ω–æ–≤—ñ—Ç—å Railway CLI** (—è–∫—â–æ —â–µ –Ω–µ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ):
   ```bash
   npm i -g @railway/cli
   ```

2. **–ó–∞–ª–æ–≥—ñ–Ω—å—Ç–µ—Å—å –≤ Railway**:
   ```bash
   railway login
   ```

3. **–ü—ñ–¥–∫–ª—é—á—ñ—Ç—å—Å—è –¥–æ –≤–∞—à–æ–≥–æ –ø—Ä–æ–µ–∫—Ç—É**:
   ```bash
   railway link
   ```

4. **–ó–∞–ø—É—Å—Ç—ñ—Ç—å —Å–∫—Ä–∏–ø—Ç –Ω–∞ Railway**:
   ```bash
   railway run python backend/reset_database.py
   ```

5. **–ü—ñ–¥—Ç–≤–µ—Ä–¥—ñ—Ç—å —Å–∫–∏–¥–∞–Ω–Ω—è** –∫–æ–ª–∏ —Å–∫—Ä–∏–ø—Ç –∑–∞–ø–∏—Ç–∞—î:
   ```
   Type 'RESET' to confirm: RESET
   ```

### –ú–µ—Ç–æ–¥ 2: –ß–µ—Ä–µ–∑ Railway Dashboard

1. **–í—ñ–¥–∫—Ä–∏–π—Ç–µ Railway Dashboard**:
   - –ü–µ—Ä–µ–π–¥—ñ—Ç—å –Ω–∞ https://railway.app
   - –í–∏–±–µ—Ä—ñ—Ç—å –≤–∞—à –ø—Ä–æ–µ–∫—Ç

2. **–í—ñ–¥–∫—Ä–∏–π—Ç–µ Shell**:
   - –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å –Ω–∞ –≤–∞—à backend service
   - –ü–µ—Ä–µ–π–¥—ñ—Ç—å –Ω–∞ –≤–∫–ª–∞–¥–∫—É "Settings"
   - –ü—Ä–æ–∫—Ä—É—Ç—ñ—Ç—å –≤–Ω–∏–∑ –¥–æ —Å–µ–∫—Ü—ñ—ó "Service"
   - –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å "Open Shell" –∞–±–æ "Connect"

3. **–ó–∞–ø—É—Å—Ç—ñ—Ç—å —Å–∫—Ä–∏–ø—Ç**:
   ```bash
   python reset_database.py
   ```

4. **–ü—ñ–¥—Ç–≤–µ—Ä–¥—ñ—Ç—å —Å–∫–∏–¥–∞–Ω–Ω—è**:
   ```
   Type 'RESET' to confirm: RESET
   ```

### –ú–µ—Ç–æ–¥ 3: –ß–µ—Ä–µ–∑ Railway Variables (–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π)

–Ø–∫—â–æ –≤–∏ —Ö–æ—á–µ—Ç–µ –∑–∞–ø—É—Å—Ç–∏—Ç–∏ —Å–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø—Ä–∏ –¥–µ–ø–ª–æ—ó:

1. **–¢–∏–º—á–∞—Å–æ–≤–æ –∑–º—ñ–Ω—ñ—Ç—å –∫–æ–º–∞–Ω–¥—É –∑–∞–ø—É—Å–∫—É**:
   - –£ Railway Dashboard ‚Üí Settings ‚Üí Deploy
   - –ó–º—ñ–Ω—ñ—Ç—å Start Command –Ω–∞: `python reset_database.py && uvicorn main:app --host 0.0.0.0 --port $PORT`

2. **–ó—Ä–æ–±—ñ—Ç—å redeploy**:
   - –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å "Deploy" –∞–±–æ –∑—Ä–æ–±—ñ—Ç—å git push

3. **–ü–æ–≤–µ—Ä–Ω—ñ—Ç—å –∫–æ–º–∞–Ω–¥—É –Ω–∞–∑–∞–¥**:
   - –ü—ñ—Å–ª—è —É—Å–ø—ñ—à–Ω–æ–≥–æ —Å–∫–∏–¥–∞–Ω–Ω—è –ø–æ–≤–µ—Ä–Ω—ñ—Ç—å Start Command –Ω–∞: `uvicorn main:app --host 0.0.0.0 --port $PORT`

‚ö†Ô∏è **–£–≤–∞–≥–∞**: –¶–µ–π –º–µ—Ç–æ–¥ –ù–ï –∑–∞–ø–∏—Ç–∞—î –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è! –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ —Ç—ñ–ª—å–∫–∏ —è–∫—â–æ –≤–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ.

## üîç –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É

–ü—ñ—Å–ª—è –∑–∞–ø—É—Å–∫—É —Å–∫—Ä–∏–ø—Ç–∞ –≤–∏ –ø–æ–±–∞—á–∏—Ç–µ:

```
üöÄ Starting database reset process...

‚ö†Ô∏è  DATABASE RESET SCRIPT
============================================================
Database URL: sqlite:///./dofa.db

‚ö†Ô∏è  WARNING: This will DELETE ALL DATA in the database!
This action cannot be undone.

Type 'RESET' to confirm: RESET

üîå Connecting to database...
   ‚úì Connected successfully

üìã Dropping all existing tables...
   Found 4 tables: user_profiles, tasks, achievements, daily_stats
   ‚úì Dropped table: user_profiles
   ‚úì Dropped table: tasks
   ‚úì Dropped table: achievements
   ‚úì Dropped table: daily_stats
   ‚úì All tables dropped successfully

üèóÔ∏è  Creating tables with new schema...
   ‚úì Created 4 tables:
      - user_profiles
      - tasks
      - achievements
      - daily_stats

üë§ Creating default user profile...
   ‚úì Default user profile created (ID: 1)

üîç Verifying database schema...
   ‚úì Table 'user_profiles' exists with 14 columns
   ‚úì Table 'tasks' exists with 11 columns
   ‚úì Table 'achievements' exists with 4 columns
   ‚úì Table 'daily_stats' exists with 7 columns

‚úÖ Database reset completed successfully!

üìä Summary:
   - All old tables dropped
   - New tables created with current schema
   - Default user profile created

üéâ Your database is now ready to use!
```

## üìä –ù–æ–≤–∞ —Å—Ö–µ–º–∞ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö

–ü—ñ—Å–ª—è —Å–∫–∏–¥–∞–Ω–Ω—è –±–∞–∑–∞ –¥–∞–Ω–∏—Ö –º–∞—Ç–∏–º–µ –Ω–∞—Å—Ç—É–ø–Ω—ñ —Ç–∞–±–ª–∏—Ü—ñ:

### 1. `user_profiles`
- –ü—Ä–æ—Ñ—ñ–ª—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –∑ –≥–µ–π–º—ñ—Ñ—ñ–∫–∞—Ü—ñ—î—é
- –ü–æ–ª—è: id, email, hashed_password, oauth_provider, oauth_id, is_active, email_verified, full_name, total_xp, current_level, current_streak, longest_streak, last_task_date, created_at, updated_at

### 2. `tasks`
- –ó–∞–≤–¥–∞–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤
- –ü–æ–ª—è: id, user_id, title, description, tag, status, priority, xp_value, is_deleted, created_at, started_at, completed_at

### 3. `achievements`
- –î–æ—Å—è–≥–Ω–µ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤
- –ü–æ–ª—è: id, user_id, achievement_key, unlocked_at

### 4. `daily_stats`
- –©–æ–¥–µ–Ω–Ω–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
- –ü–æ–ª—è: id, user_id, date, tasks_completed, quick_wins, deep_work, xp_earned, streak_count

## üõ°Ô∏è –ë–µ–∑–ø–µ–∫–∞

–°–∫—Ä–∏–ø—Ç —Ä–æ–∑—Ä–æ–±–ª–µ–Ω–∏–π –∑ —É—Ä–∞—Ö—É–≤–∞–Ω–Ω—è–º –±–µ–∑–ø–µ–∫–∏:

- ‚úÖ **–Ü–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–∏–π**: –ú–æ–∂–Ω–∞ –∑–∞–ø—É—Å–∫–∞—Ç–∏ –∫—ñ–ª—å–∫–∞ —Ä–∞–∑—ñ–≤ –±–µ–∑ –ø—Ä–æ–±–ª–µ–º
- ‚úÖ **–ü—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è**: –ó–∞–ø–∏—Ç—É—î —è–≤–Ω–µ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è –ø–µ—Ä–µ–¥ –≤–∏–¥–∞–ª–µ–Ω–Ω—è–º –¥–∞–Ω–∏—Ö
- ‚úÖ **–¢—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π–Ω–∏–π**: –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó –¥–ª—è –∞—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç—ñ –æ–ø–µ—Ä–∞—Ü—ñ–π
- ‚úÖ **–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞**: –í–µ—Ä–∏—Ñ—ñ–∫—É—î —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –≤—Å—ñ—Ö —Ç–∞–±–ª–∏—Ü—å –ø—ñ—Å–ª—è —Å–∫–∏–¥–∞–Ω–Ω—è
- ‚úÖ **–õ–æ–≥—É–≤–∞–Ω–Ω—è**: –î–µ—Ç–∞–ª—å–Ω–∏–π –≤–∏–≤—ñ–¥ –≤—Å—ñ—Ö –æ–ø–µ—Ä–∞—Ü—ñ–π

## üîß Troubleshooting

### –ü–æ–º–∏–ª–∫–∞: "No module named 'database'"

**–†—ñ—à–µ–Ω–Ω—è**: –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—å —â–æ –≤–∏ –∑–∞–ø—É—Å–∫–∞—î—Ç–µ —Å–∫—Ä–∏–ø—Ç –∑ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—ó –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—ó:
```bash
cd backend
python reset_database.py
```

–ê–±–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –ø–æ–≤–Ω–∏–π —à–ª—è—Ö:
```bash
python backend/reset_database.py
```

### –ü–æ–º–∏–ª–∫–∞: "Permission denied"

**–†—ñ—à–µ–Ω–Ω—è**: –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—å —â–æ —Ñ–∞–π–ª –º–∞—î –ø—Ä–∞–≤–∞ –Ω–∞ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è:
```bash
chmod +x backend/reset_database.py
```

### –ë–∞–∑–∞ –¥–∞–Ω–∏—Ö –Ω–µ —Å–∫–∏–¥–∞—î—Ç—å—Å—è

**–†—ñ—à–µ–Ω–Ω—è**: –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —â–æ DATABASE_URL –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–∏–π:
```bash
railway run env | grep DATABASE_URL
```

### –°–∫—Ä–∏–ø—Ç –∑–∞–≤–∏—Å–∞—î –Ω–∞ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—ñ

**–†—ñ—à–µ–Ω–Ω—è**: –Ø–∫—â–æ –≤–∏ –∑–∞–ø—É—Å–∫–∞—î—Ç–µ —á–µ—Ä–µ–∑ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π –¥–µ–ø–ª–æ–π, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –º–µ—Ç–æ–¥ 3 (–∞–ª–µ –±—É–¥—å—Ç–µ –æ–±–µ—Ä–µ–∂–Ω—ñ - –≤—ñ–Ω –Ω–µ –∑–∞–ø–∏—Ç—É—î –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è).

## üìù –ü—Ä–∏–º—ñ—Ç–∫–∏

- –°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤–∏–∑–Ω–∞—á–∞—î —Ç–∏–ø –±–∞–∑–∏ –¥–∞–Ω–∏—Ö (SQLite –∞–±–æ PostgreSQL) –∑ DATABASE_URL
- –î–ª—è SQLite —Ç–∏–º—á–∞—Å–æ–≤–æ –≤–∏–º–∏–∫–∞—î foreign key constraints –ø—ñ–¥ —á–∞—Å –≤–∏–¥–∞–ª–µ–Ω–Ω—è —Ç–∞–±–ª–∏—Ü—å
- –°—Ç–≤–æ—Ä—é—î –¥–µ—Ñ–æ–ª—Ç–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∑ ID=1 –¥–ª—è —Å—É–º—ñ—Å–Ω–æ—Å—Ç—ñ –∑ —ñ—Å–Ω—É—é—á–∏–º –∫–æ–¥–æ–º
- –í—Å—ñ timestamps –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å UTC timezone

## üîó –ü–æ–≤'—è–∑–∞–Ω—ñ —Ñ–∞–π–ª–∏

- [`backend/reset_database.py`](backend/reset_database.py) - –°–∫—Ä–∏–ø—Ç –¥–ª—è —Å–∫–∏–¥–∞–Ω–Ω—è –±–∞–∑–∏ –¥–∞–Ω–∏—Ö
- [`backend/database.py`](backend/database.py) - –°—Ö–µ–º–∞ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö
- [`RAILWAY_DEPLOYMENT_GUIDE.md`](RAILWAY_DEPLOYMENT_GUIDE.md) - –ì–∞–π–¥ –ø–æ –¥–µ–ø–ª–æ—é –Ω–∞ Railway

## ‚ùì –ü–∏—Ç–∞–Ω–Ω—è?

–Ø–∫—â–æ —É –≤–∞—Å –≤–∏–Ω–∏–∫–ª–∏ –ø—Ä–æ–±–ª–µ–º–∏ –∞–±–æ –ø–∏—Ç–∞–Ω–Ω—è:
1. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ª–æ–≥–∏ Railway Dashboard
2. –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—å —â–æ –≤—Å—ñ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ñ (requirements.txt)
3. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —â–æ DATABASE_URL –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–∏–π
